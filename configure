#!/bin/sh

if ! which vim 2>&1 1>/dev/null ; then
    echo Please install vim first, and then run it again.
    exit
fi

if ! which cscope 2>&1 1>/dev/null ; then
    echo Please install cscope package, the vim pluting needs cscope package.
    exit
fi

if ! which ctags 2>&1 1>/dev/null ; then
    echo Pleass install ctags package, the vim plugin needs ctags package.
    exit
fi

if [ $(vim --version | awk '/VIM - Vi IMproved/{print ($5>=7.4)}') -ne 1 ];then
    echo Please upgrade vim to 7.4
    exit
fi

BUNDLE_DIR=~/.vim/bundle
if [ -f ~/.vimrc ]; then
    cp ~/.vimrc ~/.vimrc.bak
fi

if [ -f ~/.vimrc.plugins ]; then
    cp ~/.vimrc.plugins ~/.vimrc.plugins.bak
fi

ln -sf $(pwd)/vimrc ~/.vimrc
ln -sf $(pwd)/vimrc.plugins ~/.vimrc.plugins

# make sure ~/.vim/bundle exist.
mkdir -p ${BUNDLE_DIR}

pushd ${BUNDLE_DIR} 2>&1 1>/dev/null
if [ -d ${BUNDLE_DIR}/Vundle.vim ]; then
    cd ${BUNDLE_DIR}/Vundle.vim && git pull -q
else
    git clone https://github.com/gmarik/Vundle.vim.git
fi
popd ${BUNDLE_DIR} 2>&1 1>/dev/null

vim -e -c BundleUpdate -c qa!
